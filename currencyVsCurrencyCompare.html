<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>CryptoClicker</title>
		<link href="stylesheet.css" rel="stylesheet">
		
	</head>
	<body>
		<header>
		<h2>Fifteen Day Price Display</h2>
		<div id='priceMenu'></div>
		</header> 
		<div id="data"></div>
		<script src="resources/Chart.js" type="text/javascript"></script>
		<canvas id="myChart" width="90%" height="30%"></canvas>
		<script>
		//cryptocurrency options
		
		var currencies = new Array();
		currencies[0] = ['Bitcoin','BTC'];
		currencies[1] = ['Ethereum','ETH'];
		currencies[2] = ['Litecoin','LTC'];
		currencies[3] = ['Monero','XMR'];
		currencies[4] = ['Dash','DASH'];
		currencies[5] = ['Dogecoin','DOGE'];
		
		//add buttons
		currencies.forEach(function(coin) {
			var inputElement = document.createElement('input');
			inputElement.type = "button";
			inputElement.id = coin[1] + "btn";
			inputElement.addEventListener('click', function(){ 
				clicked(coin[1]);
			});
		
			inputElement.value = coin[0];
			document.getElementById('priceMenu').appendChild(inputElement);
		});
		// takes js object from alphavantage, finds most recent days and closing values, and graphs these values using Chart.js
		var parseDailyData = function(jsObj){
			var dateString = jsObj["Meta Data"]["6. Last Refreshed"];
			var dateStringArr = dateString.split(" ");
			dateString = dateStringArr[0];
			var closing = jsObj["Time Series (Digital Currency Daily)"][dateString]["4b. close (USD)"];
			console.log(closing);
			var days15 = new Array();
			var closing15 = new Array();
			var i = 14;
			console.log(dateString);
			dateString = removeZeros(dateString);
			console.log(dateString);
			for(i=14;i>=0;i-=1){
				days15[i] = dateString;
				var dayWithZeros = addZeros(dateString);
				closing15[i] = jsObj["Time Series (Digital Currency Daily)"][dayWithZeros]["4b. close (USD)"];
				dateString = dayBefore(dateString);
				
			}
			var data = new Array();
			for(i=0;i<15;i++){
				data[i] = {
					x:days15[i],
					y:closing15[i]
				};
			}
			console.log(data[1]['x']);
			var ctx = document.getElementById("myChart");
			var myChart = new Chart(ctx,{
				type: 'line',
				data: {
					datasets: [{
						label: jsObj["Meta Data"]["3. Digital Currency Name"],
						data: closing15
					}],
					labels: days15
				}
			})
		};
		//remove leading zeros from month and day
		var removeZeros = function(date){
			dateSplit = date.split("-");
			if(dateSplit[1].charAt(0) == "0"){
				dateSplit[1] = dateSplit[1].charAt(1)}
			if(dateSplit[2].charAt(0) == "0"){
				dateSplit[2] = dateSplit[2].charAt(1)}
			date = dateSplit[0] + "-" + dateSplit[1] + "-" + dateSplit[2];
			return date;
		}
		//adds leading zeros to single digit months and days
		var addZeros = function(date){
			dateSplit = date.split("-");
			if(dateSplit[1].length == 1){
				dateSplit[1] = "0"+dateSplit[1];
			}
			if(dateSplit[2].length == 1){
				dateSplit[2] = "0"+dateSplit[2];
			}
			date = dateSplit[0] + "-" + dateSplit[1] + "-" + dateSplit[2];
			return date;
		}
		
		//returns the date before the one passed as a string
		//note: expects no leading zeros in the date, ie 2018-1-1, not 2018-01-01
		var dayBefore = function(day){
			daySplit = day.split("-");
			if(daySplit[2]>1){
				daySplit[2] = daySplit[2] - 1;
				return daySplit[0] + "-" + daySplit[1] + "-" + daySplit[2];
			}
			else{
				switch(daySplit[1]){
					case "12":
						return daySplit[0] + "-11-30";
						break;
					case "11":
						return daySplit[0] + "-10-31";
						break;
					case "10":
						return daySplit[0] + "-9-30";
						break;
					case "9":
						return daySplit[0] + "-8-31";
						break;
					case "8":
						return daySplit[0] + "-7-31";
						break;
					case "7":
						return daySplit[0] + "-6-30";
						break;
					case "6":
						return daySplit[0] + "-5-31";
						break;
					case "5":
						return daySplit[0] + "-4-30";
						break;
					case "4":
						return daySplit[0] + "-3-31";
						break;
					case "3":
						if(daySplit[0]%4 == 0){
							return daySplit[0] + "-2-29";
						}
						else{
							return daySplit[0] + "-2-28";
						}
						break;
					case "2":
						return daySplit[0] + "-1-31";
						break;
					case "1":
						daySplit[0] = daySplit[0] - 1;
						return daySplit[0] + "-12-31";
						break;
					default:
						return day;
						
				
				}
			}
		}
		
		//get currency info
		var clicked = function(val){
		
			var xmlhttp = new XMLHttpRequest(),
			json;
			xmlhttp.onreadystatechange = function() {
				if(xmlhttp.readyState === 4 && xmlhttp.status === 200) {
					json = JSON.parse(xmlhttp.responseText);
					//do something with your json
					console.log(json);
					//reformat and change these lines to function call 
					parseDailyData(json);
				}
			};
			var currency = val;
			console.log(currency);
			xmlhttp.open('GET', 'https://www.alphavantage.co/query?function=DIGITAL_CURRENCY_DAILY&symbol=' + currency +'&market=USD&apikey=KEIRAJC7LX8XJVVZ', true);
			xmlhttp.send();
		}
			//document.write("<h4>Price: $ " + json.E
		</script>
		<footer><p>Source: <a href='https://www.alphavantage.co'>https://www.alphavantage.co</a></p></footer>
	</body>
</html>